<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Login</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!--===============================================================================================-->
        <link rel="icon" type="image/png" href="images/icons/favicon.ico">
        <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
        <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
        <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
        <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
        <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
        <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="css/util.css">
        <link rel="stylesheet" type="text/css" href="css/main.css">
        <!--===============================================================================================-->
    </head>
    <body>
        <div class="limiter">
            <div class="container-login100">
                <div class="wrap-login100">
                    <div class="login100-pic js-tilt" data-tilt>
                        <img src="images/img-01.png" alt="IMG">
                    </div>
                    <form class="login100-form validate-form">
                        <span class="login100-form-title">
                            Đăng Nhập
                        </span>
                        <div class="wrap-input100 validate-input" data-validate="Email hợp lệ cần được cung cấp: ex@abc.xyz">
							<input
								class="input100"
								type="text"
								id="email"
								name="email"
								placeholder="Email"
							>
							<span class="focus-input100"></span>
							<span class="symbol-input100">
								<i class="fa fa-envelope" aria-hidden="true"></i>
							</span>
						</div>
						<div class="wrap-input100 validate-input" data-validate="Mật khẩu không được để trống">
							<input
								class="input100"
								type="password"
								id="password"
								name="pass"
								placeholder="Mật khẩu"
							>
							<span class="focus-input100"></span>
							<span class="symbol-input100">
								<i class="fa fa-lock" aria-hidden="true"></i>
							</span>
						</div>
						
                        <div class="container-login100-form-btn">
                            <button id="login" name="login" type="submit" class="login100-form-btn mb-3">
								Đăng Nhập
							</button>
							<button id="logout" class="login100-form-btn mb-3">Đăng xuất</button>
                            <a href="./index.html" class="login100-form-btn">
                                Trở về trang chủ
                            </a>
                        </div>
                        <div class="text-center p-t-12">
                            <input type="checkbox" id="rememberMe" required>
                            <label for="rememberMe" class="txt2">Ghi nhớ đăng nhập</label>
                        </div>
                        <div class="text-center p-t-136">
                            <a class="txt2 create-account-link" href="./res.html">
                                Tạo tài khoản của bạn
                                <i class="fa fa-long-arrow-right m-l-5" aria-hidden="true"></i>
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!--===============================================================================================-->
        <script src="vendor/jquery/jquery-3.2.1.min.js"></script>
        <!--===============================================================================================-->
        <script src="vendor/bootstrap/js/popper.js"></script>
        <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
        <!--===============================================================================================-->
        <script src="vendor/select2/select2.min.js"></script>
        <!--===============================================================================================-->
        <script src="vendor/tilt/tilt.jquery.min.js"></script>
        <script type="module">
		import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js";
		import { getDatabase, set, ref, update } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-database.js";
		import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut  } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-auth.js";

		const firebaseConfig = {
		apiKey: "AIzaSyDnyzjHh7sxc7_NjBRa0NELuwp8Riaj9fw",
		authDomain: "poly-shop-df353.firebaseapp.com",
		databaseURL: "https://poly-shop-df353-default-rtdb.firebaseio.com",
		projectId: "poly-shop-df353",
		storageBucket: "poly-shop-df353.appspot.com",
		messagingSenderId: "349797547036",
		appId: "1:349797547036:web:7882beade52a6333be33d9"
		};

		const app = initializeApp(firebaseConfig);
		const database = getDatabase(app);
		const auth = getAuth();

		document.getElementById('login').addEventListener('click', (e) => {
		e.preventDefault();

		var email = document.getElementById('email').value;
		var username = document.getElementById('username').value;
		var password = document.getElementById('password').value;

		createUserWithEmailAndPassword(auth, email, password)
			.then((userCredential) => {
				const user = userCredential.user;

				set(ref(database, 'users/' + user.uid), {
					username: username,
					email: email
				})
				alert('Đăng kí thành công!');
			})
			.catch((error) => {
				const errorCode = error.code;
				const errorMessage = error.message;
				alert(errorMessage);
			});
		});
		document.getElementById('login').addEventListener('click', (e) => {
			var email = document.getElementById('email').value;
			var password = document.getElementById('password').value;
			signInWithEmailAndPassword(auth, email, password)
		.then((userCredential) => {
			// Signed in 
			const user = userCredential.user;

			const dt = new Date();
			update(ref(database, 'users/' + user.uid), {
					last_login: dt
				})
				alert('Đăng nhập thành công!')
			// ...
			window.location.href = "./index.html";
		})
		.catch((error) => {
			const errorCode = error.code;
			const errorMessage = error.message;
			alert(errorMessage);
		});
		});

		const user = auth.currentUser;
		onAuthStateChanged(auth, (user) => {
		if (user) {
			// User is signed in, see docs for a list of available properties
			// https://firebase.google.com/docs/reference/js/auth.user
			const uid = user.uid;
			// ...
		} else {
			// User is signed out
			// ...
		}
		});
		document.getElementById('logout').addEventListener('click', (e) => {
			signOut(auth)
				.then(() => {
					// Sign-out successful.
					alert('Đăng xuất thành công!');
				})
				.catch((error) => {
					const errorCode = error.code;
					const errorMessage = error.message;
					alert(errorMessage);
				});
		});

        </script>
        <!--===============================================================================================-->
        <script src="js/main.js"></script>
    </body>
</html>
